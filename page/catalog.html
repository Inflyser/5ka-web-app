<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>5ka</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&family=Istok+Web:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="../style/style.css">
  <link rel="stylesheet" href="../style/main.css">
  <link rel="stylesheet" href="../style/catalog.css">

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º SDK Telegram -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <a href="address.html" style="text-decoration: none;">
      <button class="my-button">
        <span class="marker-center2"></span>
        <span class="btn-text" id="address">–ê–¥—Ä–µ—Å</span> <!-- address-input -->
        <img class="btn-img" src="../assets/right.png" alt="">
      </button>
    </a>
   

    <div class="search-container">
      <img src="../assets/search.png" alt="">
      <input type="text" id="searchInput" placeholder="       –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤">
    </div>
    <!-- <style>
        ul { list-style-type: none; padding-left: 1em; }
        li { margin-bottom: 10px; }
        img { vertical-align: middle; margin-right: 5px; }
    </style> -->
    <script type="module">
      import { renderCategories } from '.../scripts/categories.js';
      import { renderProducts } from '.../scripts/product.js';
      import { fetchProducts } from '.../scripts/api.js';

        
      document.addEventListener("DOMContentLoaded", () => {
          const rawCategories = JSON.parse(localStorage.getItem('categories'));
          const coords = JSON.parse(localStorage.getItem('userCoords'));

          const categoriesList = document.getElementById('categoriesList');
          const productsList = document.getElementById('productsList');
          const backBtn = document.getElementById('backBtn');

          renderCategories(rawCategories, '', async (categoryId) => {
        // –°–∫—Ä—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–Ω–∞–∑–∞–¥" –∏ —Ç–æ–≤–∞—Ä—ã
              categoriesList.style.display = 'none';
              productsList.style.display = 'block';
              backBtn.style.display = 'block';

              productsList.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...';

              if (!coords) {
                  productsList.innerHTML = '–û—à–∏–±–∫–∞: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                  return;
              }

              try {
                  const productsData = await fetchProducts(coords.lat, coords.lon, categoryId);
                  renderProducts(productsData.products);
              } catch (err) {
                  console.error(err);
                  productsList.innerHTML = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ç–æ–≤–∞—Ä–æ–≤.';
              }
          });

          // –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
          backBtn.addEventListener('click', () => {
              productsList.innerHTML = '';
              categoriesList.style.display = 'block';
              productsList.style.display = 'none';
              backBtn.style.display = 'none';
          });
      });
    </script>
    <style>
        #productsList {
            display: none;
        }
        #backBtn {
            display: none;
            margin-bottom: 1rem;
        }
    </style>


    <div class="bottom-nav">
      <a href="../index.html" class="nav-item">
        <img src="../assets/nav-icon/Component1.png" alt="–ì–ª–∞–≤–Ω–∞—è">
        <span>–ì–ª–∞–≤–Ω–∞—è</span>
      </a>
      <a href="catalog.html" class="nav-item active">
        <img src="../assets/nav-icon/Component2.png" alt="–ö–∞—Ç–∞–ª–æ–≥">
        <span>–ö–∞—Ç–∞–ª–æ–≥</span>
      </a>
      <a href="h3.html" class="nav-item">
        <img src="../assets/nav-icon/Component3.png" alt="–°–≤—è–∑–∞—Ç—å—Å—è">
        <span>–°–≤—è–∑–∞—Ç—å—Å—è</span>
      </a>
      <a href="h4.html" class="nav-item">
        <img src="../assets/nav-icon/Component4.png" alt="–ü—Ä–æ—Ñ–∏–ª—å">
        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
      </a>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const addressElem = document.getElementById('address');
        const address = localStorage.getItem('userAddress');
        if (address && addressElem) {
          addressElem.textContent = "üìç " + address;
        }
      });
    </script>
    <button id="backBtn">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
    <script src="../scripts/back-connect.js"></script>
    <script src="../scripts/categories.js"></script>
   
   
</body>
</html>
